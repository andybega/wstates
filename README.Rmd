---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# wstates

<!-- badges: start -->
[![Travis build status](https://travis-ci.com/andybega/wstates.svg?branch=master)](https://travis-ci.com/andybega/wstates)
[![Codecov test coverage](https://codecov.io/gh/andybega/wstates/branch/master/graph/badge.svg)](https://codecov.io/gh/andybega/wstates?branch=master)
<!-- badges: end -->

The goal of wcshapes is to make spatial lagging with country-year but also other panel data easier. 

**NOTE: EVEN MINIMAL CORE FUNCTIONALITY IS IN PLACE YET; NOT READY FOR USE**

## Installation

``` r
library("remotes")
install_github("andybega/wstates")
```

NOPE NOT YET: 

You can install the released version of wstates from [CRAN](https://CRAN.R-project.org) with:

``` r
install.packages("wstates")
```

## Example

```{r}
library("wstates")
library("sf")
library("ggplot2")

data("est_adm1")

est_adm1$x <- as.integer(est_adm1$NAME_1 == "Harju")
w0 <- w_dist_power(st_geometry(est_adm1), alpha = .5)
w1 <- w_dist_power(st_geometry(est_adm1), alpha = 2)
w2 <- w_contiguity(st_geometry(est_adm1))
est_adm1$x_sl0 <- as.numeric(w0 %*% est_adm1$x)
est_adm1$x_sl1 <- as.numeric(w1 %*% est_adm1$x)
est_adm1$x_sl2 <- as.numeric(w2 %*% est_adm1$x)

plot(est_adm1[, c("x", "x_sl0", "x_sl1", "x_sl2")])
```



```{r}
library("states")

# Get W matrix for certain date
w <- wstates("2010-01-01")
w
plot(w)
```

```{r}
states <- state_panel(as.Date("2011-12-31"), as.Date("2012-12-31"), partial = "exact")
states <- subset(states, !states$gwcode %in% c(396, 397))
states$x <- as.integer(
  (states$gwcode %in% c(2, 260, 490) & states$date=="2011-12-31") |
  (states$gwcode %in% c(2) & states$date=="2012-12-31"))

# spatial lag x
states$slag_x <- spatlag(states$x, states$gwcode, states$date)
head(states$slag_x)

# or, equivalently
states <- states %>%
  dplyr::mutate(slag_x = spatlag(x, gwcode, date))
dplyr::filter(states, slag_x > 0)
```

